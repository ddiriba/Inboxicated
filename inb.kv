#:kivy 2.0.0
#:import Clock kivy.clock.Clock

# List all the available screens and their ids
WindowManager:
        WelcomeScreen:
                id: welcome
        MainScreen:
                id: main
        RetrieveScreen:
                id: retrieve
        SummonScreen:
                id: summon
        AssignScreen:
                id: assign
        DepositScreen:
                id: deposit
        AddKeeperScreen:
                id: add
        ReportProblemScreen:
                id: problem
        LoadingScreen:
                id: loading
        FaceDetectionScreen:
                id: detect
        FaceRecognitionScreen:
                id: recognize

<WelcomeScreen>:
        name: 'welcome'
        BoxLayout:
                orientation: 'vertical'
                Image:
                        source: 'inbox_black.png'
                        size_hint_y: 1.0
                        allow_stretch: True
                Label:
                        text: "Swipe up to begin"
                        size_hint_y: 0.05
                        font_size: 18
                        font_name: 'Bang'

<MainScreen>:
        name: 'main'
        BoxLayout:
                orientation: 'horizontal'
                padding: 0, 10, 0, 10
                Label:
                        name: 'blank'
                        size_hint_x: 0.15
                GridLayout:
                        cols: 2
                        rows: 2
                        size_hint_x: 0.7
                        spacing: 10
                        Button:
                                background_color: '#0000FF'
                                text: "Deposit\nKeys"
                                font_size: 45
                                font_name: 'Bang'
                                halign: "center"
                                on_release: 
                                        app.change_screen("deposit", "left")
                        Button:
                                background_color: '#0000FF'
                                text: "Retrieve\nKeys"
                                font_size: 45
                                font_name: 'Bang'
                                halign: "center"
                                on_release: 
                                        app.change_screen("retrieve", "left")
                        Button:
                                background_color: '#0000FF'
                                text: "Assign\nNew Keeper"
                                font_size: 45
                                font_name: 'Bang'
                                halign: "center"
                                on_release: 
                                        app.change_screen("assign", "left")
                        Button:
                                background_color: '#0000FF'
                                text: "Summon\nthe Keepers"
                                font_size: 45
                                font_name: 'Bang'
                                halign: "center"
                Button:
                        background_color: '#FF0000'
                        text: "Report a bug" 
                        size_hint_x: 0.15
                        size_hint_y: 0.1
                        font_size: 18
                        on_release:
                                app.change_screen("problem", "left")
<RetrieveScreen>:
        name: 'retrieve'
        on_enter: app.change_screen("recognize", "left")

<DepositScreen>:
        name: 'deposit'
        MDBoxLayout:
                orientation: 'vertical'
                padding: 40
                spacing: 50
                MDLabel:
                        id: deposit_label
                        halign: 'center'
                        text: "Deposit Keys"
                        font_size: 50
                        pos_hint: {'center_x': 0.5, 'center_y': 0.5}
                        padding_y: 15
                MDCard:
                        size_hint: None, None
                        size: 300, 300
                        pos_hint: {"center_x": 0.5, "center_y": 0.5}
                        elevation: 10
                        padding: 25
                        spacing: 25
                        orientation: 'vertical'
                        MDTextFieldRound:
                                id: full_name
                                hint_text: "Full Name"
                                icon_left: "account"
                                size_hint_x: None
                                width: 200
                                font_size: 18
                                pos_hint: {"center_x": 0.5}

                        MDTextFieldRound:
                                id: phone
                                hint_text: "Phone Number"
                                icon_left: "phone"
                                size_hint_x: None
                                width: 200
                                font_size: 18
                                pos_hint: {"center_x": 0.5}
                        MDRoundFlatButton:
                                text: "Enter Contact Info"
                                font_size: 12
                                on_release: app.enter_info()
                                pos_hint: {'center_x': 0.5}
                        MDRoundFlatButton:
                                text: "Clear"
                                font_size: 12
                                on_release: app.clear_deposit_info()
                                pos_hint: {'center_x': 0.5}

                MDRaisedButton:
                        text: 'Go Back'
                        on_release: 
                                app.change_screen("main", "right")
                                app.clear_deposit_info()
                        pos_hint: {'center_x': 0.5, 'center_y': 0.5}

<AssignScreen>:
        name: 'assign'
        MDBoxLayout:
                orientation: 'vertical'
                padding: 40
                spacing: 50
                MDLabel:
                        id: assign_label
                        halign: 'center'
                        text: "Assign New Keeper"
                        font_size: 50
                        pos_hint: {'center_x': 0.5, 'center_y': 0.5}
                        padding_y: 15
                MDCard:
                        size_hint: None, None
                        size: 300, 300
                        pos_hint: {"center_x": 0.5, "center_y": 0.5}
                        elevation: 10
                        padding: 25
                        spacing: 25
                        orientation: 'vertical'
                        MDLabel:
                                id: login_label
                                halign: 'center'
                                text: "Main Keeper Login"
                                font_size: 18
                                pos_hint: {'center_x': 0.5, 'center_y': 0.5}
                                padding_y: 15
                        MDTextFieldRound:
                                id: user
                                hint_text: "Username"
                                icon_left: "account"
                                size_hint_x: None
                                width: 200
                                font_size: 18
                                pos_hint: {"center_x": 0.5}

                        MDTextFieldRound:
                                id: password
                                hint_text: "Password"
                                icon_left: "key-variant"
                                icon_right: "eye-off"
                                size_hint_x: None
                                width: 200
                                font_size: 18
                                pos_hint: {"center_x": 0.5}
                                password: True
                        MDRoundFlatButton:
                                text: "Log in"
                                font_size: 12
                                on_release: app.check_login()
                                pos_hint: {'center_x': 0.5}
                        MDRoundFlatButton:
                                text: "Clear"
                                font_size: 12
                                on_release: app.clear_assign_info()
                                pos_hint: {'center_x': 0.5}        
                MDRaisedButton:
                        text: 'Go Back'
                        on_release: 
                                app.change_screen("main", "right")
                        pos_hint: {'center_x': 0.5, 'center_y': 0.5}

<AddKeeperScreen>:
        name: 'add'
        MDBoxLayout:
                orientation: 'vertical'
                padding: 40
                spacing: 50
                MDCard:
                        size_hint: None, None
                        size: 400, 300
                        pos_hint: {"center_x": 0.5, "center_y": 0.5}
                        elevation: 10
                        padding: 25
                        spacing: 25
                        orientation: 'vertical'
                        MDLabel:
                                text: "Add New Keeper"
                                halign: 'center'
                                font_size: 18
                                pos_hint: {'center_x': 0.5, 'center_y': 0.5}
                                #padding_y: 15
                        MDTextFieldRound:
                                id: full_name
                                hint_text: "Full Name"
                                icon_left: "account"
                                size_hint_x: None
                                width: 300
                                font_size: 18
                                pos_hint: {"center_x": 0.5}

                        MDTextFieldRound:
                                id: phone
                                hint_text: "Phone Number"
                                icon_left: "phone"
                                size_hint_x: None
                                width: 300
                                font_size: 18
                                pos_hint: {"center_x": 0.5}
                        MDRoundFlatButton:
                                text: "Submit"
                                font_size: 12
                                on_release: app.add_keeper()
                                pos_hint: {'center_x': 0.5}
                        MDRoundFlatButton:
                                text: "Clear"
                                font_size: 12
                                on_release: app.clear_add_info()
                                pos_hint: {'center_x': 0.5}        
                MDRaisedButton:
                        text: 'Cancel'
                        on_release: 
                                app.change_screen("main", "right")
                        pos_hint: {'center_x': 0.5, 'center_y': 0.5}
                
<ReportProblemScreen>:
        name: 'problem'
        AnchorLayout: 
                orientation: 'vertical'
                halign: 'center'
                padding: 20
                MDTextField:
                        id: report
                        size_hint: (0.8, 0.8)
                        orientation: 'vertical'
                        hint_text: "Briefly explain what happened or what is not working." 
                        mode: "rectangle"
                        multiline: True
                        height: 200
                        width: 300
                        pos_hint: {'center_x': 0.5,'center_y': 0.5}
                BoxLayout:
                        orientation: 'horizontal'
                        pos_hint: {"center_x": 0.5, 'center_y': 0.5}
                        halign: 'center'
                        spacing: 15
                        MDRoundFlatButton:
                                text: "submit"
                                on_release: 
                                        app.send_report()
                                        app.clean_report_box()
                        MDRoundFlatButton:
                                text: "cancel"
                                on_release: 
                                        app.clean_report_box()
                                        app.change_screen("main", "right")

<LoadingScreen>:
        name: 'loading'
        on_enter: app.clear_deposit_info()

<FaceDetectionScreen>:
        name: 'detect'
        MDBoxLayout:
                id: layout
                orientation: 'vertical'
                MDLabel:
                        text: "Look at the Camera"
                        size_hint: (1, .1)
                        halign: 'center'
                        font_size: 18
                        pos_hint: {'center_x': 0.5, 'center_y': 0.5}
                MDRoundFlatButton:
                        text: "cancel"
                        pos_hint: {'center_x': 0.5}
                        on_release: 
                                app.change_screen("main", "right")

<FaceRecognitionScreen>:
        name: 'recognize'
        BoxLayout:
                orientation: 'vertical'
                Label:
                        text: "Retrieving Keys"
                        font_size: 50
                        size_hint_y: 0.1
                CameraPreview:
                        id: cam
                        size_hint_y: 0.7
                SaveButton:
                        text: "Recognize my face"
                        size_hint_x: 0.3
                        size_hint_y: 0.1
                        pos_hint: {'center_x': 0.5}
                        preview: cam
                        on_release:
                                app.recognize_face()
                Button:
                        text: "Cancel"
                        size_hint_x: 0.3
                        size_hint_y: 0.1
                        pos_hint: {'center_x': 0.5}
                        on_release:
                                app.change_screen("main", "right")
