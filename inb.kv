#:kivy 2.0.0
#:import Clock kivy.clock.Clock
#:import Factory kivy.factory.Factory

# List all the available screens and their ids
WindowManager:
        WelcomeScreen:
                id: welcome
        MainScreen:
                id: main
        RetrieveScreen:
                id: retrieve
        SummonScreen:
                id: summon
        AssignScreen:
                id: assign
        DepositScreen:
                id: deposit
        AddKeeperScreen:
                id: add
        ReportProblemScreen:
                id: problem
        LoadingScreen:
                id: loading
        FaceDetectionScreen:
                id: detect
        FaceRecognitionScreen:
                id: recognize

<WelcomeScreen>:
        name: 'welcome'
        BoxLayout:
                orientation: 'vertical'
                Image:
                        source: './HelperFiles/inboxicated_logo.png'
                        allow_stretch: False
                Label:
                        text: "Swipe up to begin"
                        color: (0,0,0,1)
                        size_hint_y: 0.05
                        font_size: 18
                        font_name: 'Bang'

<MainScreen>:
        name: 'main'
        BoxLayout:
                orientation: 'horizontal'
                padding: 0, 10, 0, 10
                Label:
                        name: 'blank'
                        size_hint_x: 0.2
                GridLayout:
                        cols: 2
                        rows: 2
                        size_hint_x: 0.6
                        spacing: 10
                        Button:
                                size: (240,240)
                                background_normal: './HelperFiles/deposit.png'
                                background_down: './HelperFiles/deposit_down.png'
                                border: 30,30,30,30
                                on_release: 
                                        app.change_screen("deposit", "left")
                        Button:
                                size: (240,240)
                                background_normal: './HelperFiles/retrieve.png'
                                background_down: './HelperFiles/retrieve_down.png'
                                border: 30,30,30,30
                                on_release: 
                                        app.change_screen("retrieve", "left")
                        Button:
                                size: (240,240)
                                background_normal: './HelperFiles/assign.png'
                                background_down: './HelperFiles/assign_down.png'
                                border: 30,30,30,30
                                on_release: 
                                        app.change_screen("assign", "left")
                        Button:
                                size: (240,240)
                                background_normal: './HelperFiles/summon.png'
                                background_down: './HelperFiles/summon_down.png'
                                border: 30,30,30,30
                                on_release: 
                                        app.change_screen("summon", "left")
                Button:
                        background_color: '#FF0000'
                        text: "Report a bug" 
                        size_hint_x: 0.2
                        size_hint_y: 0.1
                        font_size: 18
                        font_name: 'Bang' 
                        on_release:
                                app.change_screen("problem", "left")
<RetrieveScreen>:
        name: 'retrieve'
        on_enter: app.change_screen("recognize", "left")

<DepositScreen>:
        name: 'deposit'
        MDBoxLayout:
                orientation: 'horizontal'
                padding: 40
                spacing: 50
                MDLabel:
                        id: deposit_label
                        halign: 'center'
                        text: "Deposit\nKeys"
                        theme_text_color: 'ContrastParentBackground'
                        font_size: 50
                        font_name: 'Bang'
                        pos_hint_y: 0.5
                        padding_y: 15
                MDCard:
                        size_hint: None, None
                        size: 330, 330
                        pos_hint: {"center_x": 0.5, "center_y": 0.5}
                        elevation: 10
                        padding: 25
                        spacing: 25
                        background: "./HelperFiles/blue.jpg"
                        orientation: 'vertical'
                        MDLabel:
                                halign: 'center'
                                text: 'Provide Information\nto Deposit Keys'
                                font_size: 18
                        MDTextFieldRound:
                                id: user_phone
                                hint_text: "Phone Number"
                                icon_left: "phone"
                                size_hint_x: None
                                width: 200
                                font_size: 18
                                pos_hint: {"center_x": 0.5}
                        MDRoundFlatButton:
                                text: "Enter Contact Info"
                                font_size: 12
                                on_release: app.enter_info()
                                pos_hint: {'center_x': 0.5}
                        MDRoundFlatButton:
                                text: "Clear"
                                font_size: 12
                                on_release: app.clear_deposit_info()
                                pos_hint: {'center_x': 0.5}
                MDRaisedButton:
                        text: 'Go Back'
                        font_name: 'Bang'
                        on_release: 
                                app.change_screen("main", "right")
                                app.clear_deposit_info()
                        pos_hint: {'center_x': 0.5, 'center_y': 0.5}

<AssignScreen>:
        name: 'assign'
        MDBoxLayout:
                orientation: 'horizontal'
                padding: 40
                spacing: 50
                MDLabel:
                        id: assign_label
                        halign: 'center'
                        text: "Assign\nNew Keeper"
                        font_size: 50
                        font_name: 'Bang'
                        pos_hint: {'center_x': 0.5, 'center_y': 0.5}
                        padding_y: 15
                MDCard:
                        size_hint: None, None
                        size: 330, 330
                        pos_hint: {"center_x": 0.5, "center_y": 0.5}
                        elevation: 10
                        padding: 25
                        spacing: 25
                        orientation: 'vertical'
                        background: "./HelperFiles/blue.jpg"
                        MDLabel:
                                id: login_label
                                halign: 'center'
                                text: "Existing Keeper Login"
                                font_size: 18
                                pos_hint: {'center_x': 0.5, 'center_y': 0.5}
                                padding_y: 15
                        MDTextFieldRound:
                                id: keeper_phone
                                hint_text: "Phone Number"
                                icon_left: "phone"
                                size_hint_x: None
                                width: 200
                                font_size: 18
                                pos_hint: {"center_x": 0.5}
                        MDTextFieldRound:
                                id: password
                                hint_text: "6-digit Access Code"
                                icon_left: "key-variant"
                                size_hint_x: None
                                width: 200
                                font_size: 18
                                pos_hint: {"center_x": 0.5}
                                password: True
                        MDRoundFlatButton:
                                text: "Log in"
                                font_size: 12
                                on_release: app.check_login()
                                pos_hint: {'center_x': 0.5}
                        MDRoundFlatButton:
                                text: "Clear"
                                font_size: 12
                                on_release: app.clear_assign_info()
                                pos_hint: {'center_x': 0.5}        
                MDRaisedButton:
                        text: 'Go Back'
                        font_name: 'Bang'
                        on_release: 
                                app.change_screen("main", "right")
                        pos_hint: {'center_x': 0.5, 'center_y': 0.5}

<AddKeeperScreen>:
        name: 'add'
        MDBoxLayout:
                orientation: 'horizontal'
                padding: 40
                spacing: 50
                MDLabel:
                        id: assign_label
                        halign: 'center'
                        text: "Assign\nNew Keeper"
                        font_size: 50
                        font_name: 'Bang'
                        pos_hint: {'center_x': 0.5, 'center_y': 0.5}
                        padding_y: 15
                MDCard:
                        size_hint: None, None
                        size: 330, 330
                        pos_hint: {"center_x": 0.5, "center_y": 0.5}
                        elevation: 10
                        padding: 25
                        spacing: 25
                        orientation: 'vertical'
                        background: "./HelperFiles/blue.jpg"
                        MDLabel:
                                text: "Provide Your Information to\nRegister as a New Keeper"
                                halign: 'center'
                                font_size: 18
                                pos_hint: {'center_x': 0.5, 'center_y': 0.5}
                                #padding_y: 15
                        MDTextFieldRound:
                                id: keeper_phone
                                hint_text: "Phone Number"
                                icon_left: "phone"
                                size_hint_x: None
                                width: 200
                                font_size: 18
                                pos_hint: {"center_x": 0.5}

                        MDTextFieldRound:
                                id: password
                                hint_text: "6-digit Access Code"
                                icon_left: "key-variant"
                                size_hint_x: None
                                width: 200
                                font_size: 18
                                pos_hint: {"center_x": 0.5}
                        MDRoundFlatButton:
                                text: "Submit"
                                font_size: 12
                                on_release: app.add_keeper()
                                pos_hint: {'center_x': 0.5}
                        MDRoundFlatButton:
                                text: "Clear"
                                font_size: 12
                                on_release: app.clear_add_info()
                                pos_hint: {'center_x': 0.5}        
                MDRaisedButton:
                        text: 'Cancel'
                        font_name: 'Bang'
                        on_release: 
                                app.change_screen("main", "right")
                        pos_hint: {'center_x': 0.5, 'center_y': 0.5}
                
<ReportProblemScreen>:
        name: 'problem'
        BoxLayout:
                orientation: 'vertical'
                padding: 20
                spacing: 20
                Label:
                        color: (0, 0, 0, 1)
                        text: "Report a problem with the application"
                        font_name: 'Bang'
                        font_size: 35
                        pos_hint: {'center_x': 0.5}
                        size_hint_y: 0.1
                Label:
                        color: (0, 0, 0, 1)
                        text: "What part of Inboxicated is not working?"
                        font_size: 20
                        pos_hint: {'center_x': 0.5}
                        size_hint_y: 0.05
                Spinner:
                        size_hint: None, None
                        size: 300, 50
                        pos_hint: {'center_x': 0.5}
                        background_normal: "./HelperFiles/blue.jpg"
                        background_down: "./HelperFiles/blue.jpg"
                        option_cls: Factory.get("MySpinnerOption")
                        text: 'Hardware not working properly'
                        color: '#808080'
                        values: 'Key retrieval not working properly', 'Camera is not working', 'Cannot register to Inboxicated as a user', 'Cannot register to Inboxicated as a keeper', 'Other'       
        
                MDTextField:
                        id: report
                        size_hint: (0.9, 0.9)
                        orientation: 'vertical'
                        hint_text: "Briefly explain the details of the issue." 
                        mode: "rectangle"
                        multiline: True
                        height: 100
                        width: 200
                        pos_hint: {'center_x': 0.5,'center_y': 0.5}
                BoxLayout:
                        orientation: 'horizontal'
                        halign: 'center'
                        size_hint_y: 0.1
                        size_hiny_x: None
                        MDRoundFlatButton:
                                text: "submit"
                                on_release: 
                                        app.send_report()
                                        app.clean_report_box()
                        MDRoundFlatButton:
                                text: "cancel"
                                on_release: 
                                        app.clean_report_box()
                                        app.change_screen("main", "right")

<LoadingScreen>:
        name: 'loading'
        on_enter: app.clear_deposit_info()
        MDSpinner:
                size_hint: None, None
                size: dp(46), dp(46)
                pos_hint: {'center_x': .5, 'center_y': .5}
                active: True

<RecognizerPopUp>:
        name: 'rec_load'
        auto_dismiss: False
        title: "Face Recognition"
        BoxLayout:
                orientation: 'vertical'
                Label:
                        text: "Recognizing your face. Please wait."
                MDSpinner:
                        #title: "Recognizing your face. Please wait."
                        size_hint: None, None
                        size: dp(46), dp(46)
                        pos_hint: {'center_x': .5, 'center_y': .5}
                        active: True



<FaceDetectionScreen>:
        name: 'detect'
        BoxLayout:
                id: layout
                orientation: 'vertical'
                Label:
                        text: "Look at the Camera"
                        size_hint: (1, .1)
                        halign: 'center'
                        font_size: 18
                BoundingPreview:
                        id: bound 
                        size_hint_y: 0.7
                
                SaveButton:
                        text: "Take Photo"
                        size_hint_x: 0.3
                        size_hint_y: 0.1
                        pos_hint: {'center_x': 0.5}
                        preview: bound
                        on_press:
                                app.take_photo()
                        on_release:
                                app.send_info()
                                app.change_screen("main", "right")
                Button:
                        text: "Cancel"
                        size_hint_x: 0.3
                        size_hint_y: 0.1
                        pos_hint: {'center_x': 0.5}
                        on_release: 
                                app.change_screen("main", "right")

<FaceRecognitionScreen>:
        name: 'recognize'
        BoxLayout:
                orientation: 'vertical'
                Label:
                        text: "Retrieving Keys"
                        font_size: 50
                        size_hint_y: 0.1
                        color: (0,0,0,1)
                CameraPreview:
                        id: cam
                        size_hint_y: 0.7
                SaveButton:
                        text: "Recognize my face"
                        size_hint_x: 0.3
                        size_hint_y: 0.1
                        pos_hint: {'center_x': 0.5}
                        preview: cam
                        on_release:
                                app.recognize_face()
                Button:
                        text: "Cancel"
                        size_hint_x: 0.3
                        size_hint_y: 0.1
                        pos_hint: {'center_x': 0.5}
                        on_release:
                                app.change_screen("main", "right")

<SummonScreen>:
        name: 'summon'
        MDBoxLayout:
                orientation: 'horizontal'
                padding: 40
                spacing: 50
                MDLabel:
                        id: summon_label
                        halign: 'center'
                        text: "Contact\nthe Keepers"
                        theme_text_color: 'ContrastParentBackground'
                        font_size: 50
                        font_name: 'Bang'
                        pos_hint_y: 0.5
                        padding_y: 15
                MDLabel:
                        text: "Coming soon..."
                        font_size: 25
                MDRaisedButton:
                        text: 'Go Back'
                        font_name: 'Bang'
                        on_release: 
                                app.change_screen("main", "right")
                        pos_hint: {'center_x': 0.5, 'center_y': 0.5}

<MySpinnerOption@SpinnerOption>:
        background_color: '#1C63A9' 
